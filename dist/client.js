module.exports =
/******/ (function(modules) { // webpackBootstrap
/******/ 	// The module cache
/******/ 	var installedModules = {};
/******/
/******/ 	// The require function
/******/ 	function __webpack_require__(moduleId) {
/******/
/******/ 		// Check if module is in cache
/******/ 		if(installedModules[moduleId])
/******/ 			return installedModules[moduleId].exports;
/******/
/******/ 		// Create a new module (and put it into the cache)
/******/ 		var module = installedModules[moduleId] = {
/******/ 			exports: {},
/******/ 			id: moduleId,
/******/ 			loaded: false
/******/ 		};
/******/
/******/ 		// Execute the module function
/******/ 		modules[moduleId].call(module.exports, module, module.exports, __webpack_require__);
/******/
/******/ 		// Flag the module as loaded
/******/ 		module.loaded = true;
/******/
/******/ 		// Return the exports of the module
/******/ 		return module.exports;
/******/ 	}
/******/
/******/
/******/ 	// expose the modules object (__webpack_modules__)
/******/ 	__webpack_require__.m = modules;
/******/
/******/ 	// expose the module cache
/******/ 	__webpack_require__.c = installedModules;
/******/
/******/ 	// __webpack_public_path__
/******/ 	__webpack_require__.p = "";
/******/
/******/ 	// Load entry module and return exports
/******/ 	return __webpack_require__(0);
/******/ })
/************************************************************************/
/******/ ([
/* 0 */
/***/ function(module, exports, __webpack_require__) {

	'use strict';
	var io = __webpack_require__(1);
	var MESSAGES_1 = __webpack_require__(2);
	var dbg = __webpack_require__(3);
	var debug = dbg('ngServer-Client');
	var Client = (function () {
	    function Client(bridgeAddress) {
	        this.bridgeAddress = bridgeAddress;
	        this.socket = io.connect(this.bridgeAddress);
	        this.socket.on('connect', function () {
	            debug('Client connected to Bridge');
	        });
	    }
	    Client.prototype.middleware = function (req, res, next) {
	        var _this = this;
	        debug('MiddleWare called with URL ', req.url);
	        if (req.method !== 'GET') {
	            next();
	        }
	        if (req.xhr === true) {
	            next();
	        }
	        if (/text\/html/.test(req.get('accept')) !== true) {
	            next();
	        }
	        var send = res.send.bind(res);
	        res.send = function (body) {
	            if (typeof body === 'string') {
	                _this.renderHTML(req.url, body, function (response) {
	                    switch (response.status) {
	                        case MESSAGES_1.ENUM_CACHE_STATUS.HTML:
	                            res.location(req.url);
	                            res.status(200);
	                            return send.apply(this, [response.html]);
	                        default:
	                            res.location(req.url);
	                            res.status(200);
	                            return send.apply(this, [body]);
	                    }
	                });
	            }
	            else {
	                return send.apply(_this, [body]);
	            }
	        };
	        next();
	    };
	    ;
	    Client.prototype.renderURL = function (url, cb) {
	        var _this = this;
	        debug('Render URL called', url);
	        this.socket.emit(MESSAGES_1.MSG.CHECK_URL, url);
	        this.socket.on(MESSAGES_1.MSG.ANSWER, function (response) {
	            debug('Client Answer is', MESSAGES_1.ENUM_CACHE_STATUS[response.status]);
	            switch (response.status) {
	                case MESSAGES_1.ENUM_CACHE_STATUS.HTML:
	                    debug('client: Closing socket');
	                    _this.socket.close();
	                    cb({
	                        status: MESSAGES_1.ENUM_CACHE_STATUS.HTML,
	                        html: response.html
	                    });
	                    break;
	                case MESSAGES_1.ENUM_CACHE_STATUS.NO_RENDER:
	                    _this.socket.close();
	                    cb({
	                        status: MESSAGES_1.ENUM_CACHE_STATUS.NO_RENDER
	                    });
	                    break;
	                case MESSAGES_1.ENUM_CACHE_STATUS.RENDER_NO_CACHE:
	                    _this.askBridge({ url: url, strategy: MESSAGES_1.ENUM_CACHE_STATUS.RENDER_NO_CACHE }, cb);
	                    break;
	                case MESSAGES_1.ENUM_CACHE_STATUS.RENDER_CACHE:
	                    _this.askBridge({ url: url, strategy: MESSAGES_1.ENUM_CACHE_STATUS.RENDER_CACHE }, cb);
	                    break;
	                case MESSAGES_1.ENUM_CACHE_STATUS.ERROR:
	                    throw response.err;
	            }
	        });
	    };
	    Client.prototype.renderHTML = function (url, html, cb) {
	        var _this = this;
	        debug('renderHTML called', url);
	        this.socket.emit(MESSAGES_1.MSG.CHECK_URL, url);
	        this.socket.on(MESSAGES_1.MSG.ANSWER, function (response) {
	            switch (response.status) {
	                case MESSAGES_1.ENUM_CACHE_STATUS.HTML:
	                    _this.socket.close();
	                    cb({
	                        status: MESSAGES_1.ENUM_CACHE_STATUS.HTML,
	                        html: response.html
	                    });
	                    break;
	                case MESSAGES_1.ENUM_CACHE_STATUS.NO_RENDER:
	                    _this.socket.close();
	                    cb({
	                        status: MESSAGES_1.ENUM_CACHE_STATUS.NO_RENDER
	                    });
	                    break;
	                case MESSAGES_1.ENUM_CACHE_STATUS.RENDER_NO_CACHE:
	                    _this.askBridge({ url: url, strategy: MESSAGES_1.ENUM_CACHE_STATUS.RENDER_NO_CACHE, html: html }, cb);
	                    break;
	                case MESSAGES_1.ENUM_CACHE_STATUS.RENDER_CACHE:
	                    _this.askBridge({ url: url, strategy: MESSAGES_1.ENUM_CACHE_STATUS.RENDER_CACHE, html: html }, cb);
	                    break;
	                case MESSAGES_1.ENUM_CACHE_STATUS.ERROR:
	                    _this.socket.close();
	                    throw response.err;
	            }
	        });
	    };
	    Client.prototype.askBridge = function (query, cb) {
	        var _this = this;
	        debug('Emitting GET_URL from Client to Bridge');
	        this.socket.on(MESSAGES_1.MSG.RENDER_STATUS, function (response) {
	            debug('Response received from Bridge External', MESSAGES_1.ENUM_RENDER_STATUS[response.status]);
	            switch (response.status) {
	                case MESSAGES_1.ENUM_RENDER_STATUS.HTML:
	                    debug('Client - closing socket');
	                    _this.socket.close();
	                    return cb({
	                        status: MESSAGES_1.ENUM_RENDER_STATUS.HTML,
	                        html: response.html
	                    });
	                case MESSAGES_1.ENUM_RENDER_STATUS.STARTED:
	                case MESSAGES_1.ENUM_RENDER_STATUS.QUEUED:
	                    break;
	                case MESSAGES_1.ENUM_RENDER_STATUS.ERROR:
	                    _this.socket.close();
	                    return cb({
	                        status: MESSAGES_1.ENUM_CACHE_STATUS.ERROR
	                    });
	            }
	        });
	        this.socket.emit(MESSAGES_1.MSG.GET_URL, query);
	    };
	    return Client;
	}());
	module.exports = Client;


/***/ },
/* 1 */
/***/ function(module, exports) {

	module.exports = require("socket.io-client");

/***/ },
/* 2 */
/***/ function(module, exports) {

	'use strict';
	exports.MSG = {
	    CHECK_URL: 'CHECK_URL',
	    GET_URL: 'GET_URL',
	    ANSWER: 'PARAM_CLIENT_ANSWER',
	    RENDER_STATUS: 'ENUM_CACHE_STATUS',
	    IDLE: 'IDLE',
	    LOG: 'LOG',
	    ERROR: 'ERROR',
	};
	var ENUM_RENDER_STATUS;
	(function (ENUM_RENDER_STATUS) {
	    ENUM_RENDER_STATUS[ENUM_RENDER_STATUS["STARTED"] = 0] = "STARTED";
	    ENUM_RENDER_STATUS[ENUM_RENDER_STATUS["QUEUED"] = 1] = "QUEUED";
	    ENUM_RENDER_STATUS[ENUM_RENDER_STATUS["HTML"] = 2] = "HTML";
	    ENUM_RENDER_STATUS[ENUM_RENDER_STATUS["ERROR"] = 3] = "ERROR";
	})(ENUM_RENDER_STATUS = exports.ENUM_RENDER_STATUS || (exports.ENUM_RENDER_STATUS = {}));
	;
	var ENUM_CACHE_STATUS;
	(function (ENUM_CACHE_STATUS) {
	    ENUM_CACHE_STATUS[ENUM_CACHE_STATUS["RENDER_CACHE"] = 0] = "RENDER_CACHE";
	    ENUM_CACHE_STATUS[ENUM_CACHE_STATUS["NO_RENDER"] = 1] = "NO_RENDER";
	    ENUM_CACHE_STATUS[ENUM_CACHE_STATUS["HTML"] = 2] = "HTML";
	    ENUM_CACHE_STATUS[ENUM_CACHE_STATUS["RENDER_NO_CACHE"] = 3] = "RENDER_NO_CACHE";
	    ENUM_CACHE_STATUS[ENUM_CACHE_STATUS["ERROR"] = 4] = "ERROR";
	})(ENUM_CACHE_STATUS = exports.ENUM_CACHE_STATUS || (exports.ENUM_CACHE_STATUS = {}));
	;
	var ENUM_SLIMER_ERRORS;
	(function (ENUM_SLIMER_ERRORS) {
	    ENUM_SLIMER_ERRORS[ENUM_SLIMER_ERRORS["FILE_ACCESS_ERROR"] = 5] = "FILE_ACCESS_ERROR";
	    ENUM_SLIMER_ERRORS[ENUM_SLIMER_ERRORS["NETWORK_ERROR"] = 6] = "NETWORK_ERROR";
	    ENUM_SLIMER_ERRORS[ENUM_SLIMER_ERRORS["WEBAPP_ERROR"] = 7] = "WEBAPP_ERROR";
	    ENUM_SLIMER_ERRORS[ENUM_SLIMER_ERRORS["LOGIC_ERROR"] = 8] = "LOGIC_ERROR";
	})(ENUM_SLIMER_ERRORS = exports.ENUM_SLIMER_ERRORS || (exports.ENUM_SLIMER_ERRORS = {}));
	;


/***/ },
/* 3 */
/***/ function(module, exports) {

	module.exports = require("debug");

/***/ }
/******/ ]);
//# sourceMappingURL=data:application/json;charset=utf-8;base64,eyJ2ZXJzaW9uIjozLCJzb3VyY2VzIjpbIndlYnBhY2s6Ly8vd2VicGFjay9ib290c3RyYXAgNmQzOWUzYWZhZjFiZTk4NWI0OTMiLCJ3ZWJwYWNrOi8vLy4vc3JjL2NsaWVudC50cyIsIndlYnBhY2s6Ly8vZXh0ZXJuYWwgXCJzb2NrZXQuaW8tY2xpZW50XCIiLCJ3ZWJwYWNrOi8vLy4vc3JjL01FU1NBR0VTLnRzIiwid2VicGFjazovLy9leHRlcm5hbCBcImRlYnVnXCIiXSwibmFtZXMiOltdLCJtYXBwaW5ncyI6Ijs7QUFBQTtBQUNBOztBQUVBO0FBQ0E7O0FBRUE7QUFDQTtBQUNBOztBQUVBO0FBQ0E7QUFDQSx1QkFBZTtBQUNmO0FBQ0E7QUFDQTs7QUFFQTtBQUNBOztBQUVBO0FBQ0E7O0FBRUE7QUFDQTtBQUNBOzs7QUFHQTtBQUNBOztBQUVBO0FBQ0E7O0FBRUE7QUFDQTs7QUFFQTtBQUNBOzs7Ozs7O0FDdENBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQSxVQUFTO0FBQ1Q7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0Esa0JBQWlCO0FBQ2pCO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBLHNCQUFxQjtBQUNyQjtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0Esc0JBQXFCO0FBQ3JCO0FBQ0E7QUFDQSxzQ0FBcUMsbUVBQW1FO0FBQ3hHO0FBQ0E7QUFDQSxzQ0FBcUMsZ0VBQWdFO0FBQ3JHO0FBQ0E7QUFDQTtBQUNBO0FBQ0EsVUFBUztBQUNUO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBLHNCQUFxQjtBQUNyQjtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0Esc0JBQXFCO0FBQ3JCO0FBQ0E7QUFDQSxzQ0FBcUMsK0VBQStFO0FBQ3BIO0FBQ0E7QUFDQSxzQ0FBcUMsNEVBQTRFO0FBQ2pIO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQSxVQUFTO0FBQ1Q7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQSxzQkFBcUI7QUFDckI7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQSxzQkFBcUI7QUFDckI7QUFDQSxVQUFTO0FBQ1Q7QUFDQTtBQUNBO0FBQ0EsRUFBQztBQUNEOzs7Ozs7O0FDMUlBLDhDOzs7Ozs7QUNBQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBLEVBQUMscUZBQXFGO0FBQ3RGO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQSxFQUFDLGtGQUFrRjtBQUNuRjtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBLEVBQUMscUZBQXFGO0FBQ3RGOzs7Ozs7O0FDbENBLG1DIiwiZmlsZSI6ImNsaWVudC5qcyIsInNvdXJjZXNDb250ZW50IjpbIiBcdC8vIFRoZSBtb2R1bGUgY2FjaGVcbiBcdHZhciBpbnN0YWxsZWRNb2R1bGVzID0ge307XG5cbiBcdC8vIFRoZSByZXF1aXJlIGZ1bmN0aW9uXG4gXHRmdW5jdGlvbiBfX3dlYnBhY2tfcmVxdWlyZV9fKG1vZHVsZUlkKSB7XG5cbiBcdFx0Ly8gQ2hlY2sgaWYgbW9kdWxlIGlzIGluIGNhY2hlXG4gXHRcdGlmKGluc3RhbGxlZE1vZHVsZXNbbW9kdWxlSWRdKVxuIFx0XHRcdHJldHVybiBpbnN0YWxsZWRNb2R1bGVzW21vZHVsZUlkXS5leHBvcnRzO1xuXG4gXHRcdC8vIENyZWF0ZSBhIG5ldyBtb2R1bGUgKGFuZCBwdXQgaXQgaW50byB0aGUgY2FjaGUpXG4gXHRcdHZhciBtb2R1bGUgPSBpbnN0YWxsZWRNb2R1bGVzW21vZHVsZUlkXSA9IHtcbiBcdFx0XHRleHBvcnRzOiB7fSxcbiBcdFx0XHRpZDogbW9kdWxlSWQsXG4gXHRcdFx0bG9hZGVkOiBmYWxzZVxuIFx0XHR9O1xuXG4gXHRcdC8vIEV4ZWN1dGUgdGhlIG1vZHVsZSBmdW5jdGlvblxuIFx0XHRtb2R1bGVzW21vZHVsZUlkXS5jYWxsKG1vZHVsZS5leHBvcnRzLCBtb2R1bGUsIG1vZHVsZS5leHBvcnRzLCBfX3dlYnBhY2tfcmVxdWlyZV9fKTtcblxuIFx0XHQvLyBGbGFnIHRoZSBtb2R1bGUgYXMgbG9hZGVkXG4gXHRcdG1vZHVsZS5sb2FkZWQgPSB0cnVlO1xuXG4gXHRcdC8vIFJldHVybiB0aGUgZXhwb3J0cyBvZiB0aGUgbW9kdWxlXG4gXHRcdHJldHVybiBtb2R1bGUuZXhwb3J0cztcbiBcdH1cblxuXG4gXHQvLyBleHBvc2UgdGhlIG1vZHVsZXMgb2JqZWN0IChfX3dlYnBhY2tfbW9kdWxlc19fKVxuIFx0X193ZWJwYWNrX3JlcXVpcmVfXy5tID0gbW9kdWxlcztcblxuIFx0Ly8gZXhwb3NlIHRoZSBtb2R1bGUgY2FjaGVcbiBcdF9fd2VicGFja19yZXF1aXJlX18uYyA9IGluc3RhbGxlZE1vZHVsZXM7XG5cbiBcdC8vIF9fd2VicGFja19wdWJsaWNfcGF0aF9fXG4gXHRfX3dlYnBhY2tfcmVxdWlyZV9fLnAgPSBcIlwiO1xuXG4gXHQvLyBMb2FkIGVudHJ5IG1vZHVsZSBhbmQgcmV0dXJuIGV4cG9ydHNcbiBcdHJldHVybiBfX3dlYnBhY2tfcmVxdWlyZV9fKDApO1xuXG5cblxuLy8gV0VCUEFDSyBGT09URVIgLy9cbi8vIHdlYnBhY2svYm9vdHN0cmFwIDZkMzllM2FmYWYxYmU5ODViNDkzIiwiJ3VzZSBzdHJpY3QnO1xudmFyIGlvID0gcmVxdWlyZShcInNvY2tldC5pby1jbGllbnRcIik7XG52YXIgTUVTU0FHRVNfMSA9IHJlcXVpcmUoXCIuL01FU1NBR0VTXCIpO1xudmFyIGRiZyA9IHJlcXVpcmUoXCJkZWJ1Z1wiKTtcbnZhciBkZWJ1ZyA9IGRiZygnbmdTZXJ2ZXItQ2xpZW50Jyk7XG52YXIgQ2xpZW50ID0gKGZ1bmN0aW9uICgpIHtcbiAgICBmdW5jdGlvbiBDbGllbnQoYnJpZGdlQWRkcmVzcykge1xuICAgICAgICB0aGlzLmJyaWRnZUFkZHJlc3MgPSBicmlkZ2VBZGRyZXNzO1xuICAgICAgICB0aGlzLnNvY2tldCA9IGlvLmNvbm5lY3QodGhpcy5icmlkZ2VBZGRyZXNzKTtcbiAgICAgICAgdGhpcy5zb2NrZXQub24oJ2Nvbm5lY3QnLCBmdW5jdGlvbiAoKSB7XG4gICAgICAgICAgICBkZWJ1ZygnQ2xpZW50IGNvbm5lY3RlZCB0byBCcmlkZ2UnKTtcbiAgICAgICAgfSk7XG4gICAgfVxuICAgIENsaWVudC5wcm90b3R5cGUubWlkZGxld2FyZSA9IGZ1bmN0aW9uIChyZXEsIHJlcywgbmV4dCkge1xuICAgICAgICB2YXIgX3RoaXMgPSB0aGlzO1xuICAgICAgICBkZWJ1ZygnTWlkZGxlV2FyZSBjYWxsZWQgd2l0aCBVUkwgJywgcmVxLnVybCk7XG4gICAgICAgIGlmIChyZXEubWV0aG9kICE9PSAnR0VUJykge1xuICAgICAgICAgICAgbmV4dCgpO1xuICAgICAgICB9XG4gICAgICAgIGlmIChyZXEueGhyID09PSB0cnVlKSB7XG4gICAgICAgICAgICBuZXh0KCk7XG4gICAgICAgIH1cbiAgICAgICAgaWYgKC90ZXh0XFwvaHRtbC8udGVzdChyZXEuZ2V0KCdhY2NlcHQnKSkgIT09IHRydWUpIHtcbiAgICAgICAgICAgIG5leHQoKTtcbiAgICAgICAgfVxuICAgICAgICB2YXIgc2VuZCA9IHJlcy5zZW5kLmJpbmQocmVzKTtcbiAgICAgICAgcmVzLnNlbmQgPSBmdW5jdGlvbiAoYm9keSkge1xuICAgICAgICAgICAgaWYgKHR5cGVvZiBib2R5ID09PSAnc3RyaW5nJykge1xuICAgICAgICAgICAgICAgIF90aGlzLnJlbmRlckhUTUwocmVxLnVybCwgYm9keSwgZnVuY3Rpb24gKHJlc3BvbnNlKSB7XG4gICAgICAgICAgICAgICAgICAgIHN3aXRjaCAocmVzcG9uc2Uuc3RhdHVzKSB7XG4gICAgICAgICAgICAgICAgICAgICAgICBjYXNlIE1FU1NBR0VTXzEuRU5VTV9DQUNIRV9TVEFUVVMuSFRNTDpcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICByZXMubG9jYXRpb24ocmVxLnVybCk7XG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgcmVzLnN0YXR1cygyMDApO1xuICAgICAgICAgICAgICAgICAgICAgICAgICAgIHJldHVybiBzZW5kLmFwcGx5KHRoaXMsIFtyZXNwb25zZS5odG1sXSk7XG4gICAgICAgICAgICAgICAgICAgICAgICBkZWZhdWx0OlxuICAgICAgICAgICAgICAgICAgICAgICAgICAgIHJlcy5sb2NhdGlvbihyZXEudXJsKTtcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICByZXMuc3RhdHVzKDIwMCk7XG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgcmV0dXJuIHNlbmQuYXBwbHkodGhpcywgW2JvZHldKTtcbiAgICAgICAgICAgICAgICAgICAgfVxuICAgICAgICAgICAgICAgIH0pO1xuICAgICAgICAgICAgfVxuICAgICAgICAgICAgZWxzZSB7XG4gICAgICAgICAgICAgICAgcmV0dXJuIHNlbmQuYXBwbHkoX3RoaXMsIFtib2R5XSk7XG4gICAgICAgICAgICB9XG4gICAgICAgIH07XG4gICAgICAgIG5leHQoKTtcbiAgICB9O1xuICAgIDtcbiAgICBDbGllbnQucHJvdG90eXBlLnJlbmRlclVSTCA9IGZ1bmN0aW9uICh1cmwsIGNiKSB7XG4gICAgICAgIHZhciBfdGhpcyA9IHRoaXM7XG4gICAgICAgIGRlYnVnKCdSZW5kZXIgVVJMIGNhbGxlZCcsIHVybCk7XG4gICAgICAgIHRoaXMuc29ja2V0LmVtaXQoTUVTU0FHRVNfMS5NU0cuQ0hFQ0tfVVJMLCB1cmwpO1xuICAgICAgICB0aGlzLnNvY2tldC5vbihNRVNTQUdFU18xLk1TRy5BTlNXRVIsIGZ1bmN0aW9uIChyZXNwb25zZSkge1xuICAgICAgICAgICAgZGVidWcoJ0NsaWVudCBBbnN3ZXIgaXMnLCBNRVNTQUdFU18xLkVOVU1fQ0FDSEVfU1RBVFVTW3Jlc3BvbnNlLnN0YXR1c10pO1xuICAgICAgICAgICAgc3dpdGNoIChyZXNwb25zZS5zdGF0dXMpIHtcbiAgICAgICAgICAgICAgICBjYXNlIE1FU1NBR0VTXzEuRU5VTV9DQUNIRV9TVEFUVVMuSFRNTDpcbiAgICAgICAgICAgICAgICAgICAgZGVidWcoJ2NsaWVudDogQ2xvc2luZyBzb2NrZXQnKTtcbiAgICAgICAgICAgICAgICAgICAgX3RoaXMuc29ja2V0LmNsb3NlKCk7XG4gICAgICAgICAgICAgICAgICAgIGNiKHtcbiAgICAgICAgICAgICAgICAgICAgICAgIHN0YXR1czogTUVTU0FHRVNfMS5FTlVNX0NBQ0hFX1NUQVRVUy5IVE1MLFxuICAgICAgICAgICAgICAgICAgICAgICAgaHRtbDogcmVzcG9uc2UuaHRtbFxuICAgICAgICAgICAgICAgICAgICB9KTtcbiAgICAgICAgICAgICAgICAgICAgYnJlYWs7XG4gICAgICAgICAgICAgICAgY2FzZSBNRVNTQUdFU18xLkVOVU1fQ0FDSEVfU1RBVFVTLk5PX1JFTkRFUjpcbiAgICAgICAgICAgICAgICAgICAgX3RoaXMuc29ja2V0LmNsb3NlKCk7XG4gICAgICAgICAgICAgICAgICAgIGNiKHtcbiAgICAgICAgICAgICAgICAgICAgICAgIHN0YXR1czogTUVTU0FHRVNfMS5FTlVNX0NBQ0hFX1NUQVRVUy5OT19SRU5ERVJcbiAgICAgICAgICAgICAgICAgICAgfSk7XG4gICAgICAgICAgICAgICAgICAgIGJyZWFrO1xuICAgICAgICAgICAgICAgIGNhc2UgTUVTU0FHRVNfMS5FTlVNX0NBQ0hFX1NUQVRVUy5SRU5ERVJfTk9fQ0FDSEU6XG4gICAgICAgICAgICAgICAgICAgIF90aGlzLmFza0JyaWRnZSh7IHVybDogdXJsLCBzdHJhdGVneTogTUVTU0FHRVNfMS5FTlVNX0NBQ0hFX1NUQVRVUy5SRU5ERVJfTk9fQ0FDSEUgfSwgY2IpO1xuICAgICAgICAgICAgICAgICAgICBicmVhaztcbiAgICAgICAgICAgICAgICBjYXNlIE1FU1NBR0VTXzEuRU5VTV9DQUNIRV9TVEFUVVMuUkVOREVSX0NBQ0hFOlxuICAgICAgICAgICAgICAgICAgICBfdGhpcy5hc2tCcmlkZ2UoeyB1cmw6IHVybCwgc3RyYXRlZ3k6IE1FU1NBR0VTXzEuRU5VTV9DQUNIRV9TVEFUVVMuUkVOREVSX0NBQ0hFIH0sIGNiKTtcbiAgICAgICAgICAgICAgICAgICAgYnJlYWs7XG4gICAgICAgICAgICAgICAgY2FzZSBNRVNTQUdFU18xLkVOVU1fQ0FDSEVfU1RBVFVTLkVSUk9SOlxuICAgICAgICAgICAgICAgICAgICB0aHJvdyByZXNwb25zZS5lcnI7XG4gICAgICAgICAgICB9XG4gICAgICAgIH0pO1xuICAgIH07XG4gICAgQ2xpZW50LnByb3RvdHlwZS5yZW5kZXJIVE1MID0gZnVuY3Rpb24gKHVybCwgaHRtbCwgY2IpIHtcbiAgICAgICAgdmFyIF90aGlzID0gdGhpcztcbiAgICAgICAgZGVidWcoJ3JlbmRlckhUTUwgY2FsbGVkJywgdXJsKTtcbiAgICAgICAgdGhpcy5zb2NrZXQuZW1pdChNRVNTQUdFU18xLk1TRy5DSEVDS19VUkwsIHVybCk7XG4gICAgICAgIHRoaXMuc29ja2V0Lm9uKE1FU1NBR0VTXzEuTVNHLkFOU1dFUiwgZnVuY3Rpb24gKHJlc3BvbnNlKSB7XG4gICAgICAgICAgICBzd2l0Y2ggKHJlc3BvbnNlLnN0YXR1cykge1xuICAgICAgICAgICAgICAgIGNhc2UgTUVTU0FHRVNfMS5FTlVNX0NBQ0hFX1NUQVRVUy5IVE1MOlxuICAgICAgICAgICAgICAgICAgICBfdGhpcy5zb2NrZXQuY2xvc2UoKTtcbiAgICAgICAgICAgICAgICAgICAgY2Ioe1xuICAgICAgICAgICAgICAgICAgICAgICAgc3RhdHVzOiBNRVNTQUdFU18xLkVOVU1fQ0FDSEVfU1RBVFVTLkhUTUwsXG4gICAgICAgICAgICAgICAgICAgICAgICBodG1sOiByZXNwb25zZS5odG1sXG4gICAgICAgICAgICAgICAgICAgIH0pO1xuICAgICAgICAgICAgICAgICAgICBicmVhaztcbiAgICAgICAgICAgICAgICBjYXNlIE1FU1NBR0VTXzEuRU5VTV9DQUNIRV9TVEFUVVMuTk9fUkVOREVSOlxuICAgICAgICAgICAgICAgICAgICBfdGhpcy5zb2NrZXQuY2xvc2UoKTtcbiAgICAgICAgICAgICAgICAgICAgY2Ioe1xuICAgICAgICAgICAgICAgICAgICAgICAgc3RhdHVzOiBNRVNTQUdFU18xLkVOVU1fQ0FDSEVfU1RBVFVTLk5PX1JFTkRFUlxuICAgICAgICAgICAgICAgICAgICB9KTtcbiAgICAgICAgICAgICAgICAgICAgYnJlYWs7XG4gICAgICAgICAgICAgICAgY2FzZSBNRVNTQUdFU18xLkVOVU1fQ0FDSEVfU1RBVFVTLlJFTkRFUl9OT19DQUNIRTpcbiAgICAgICAgICAgICAgICAgICAgX3RoaXMuYXNrQnJpZGdlKHsgdXJsOiB1cmwsIHN0cmF0ZWd5OiBNRVNTQUdFU18xLkVOVU1fQ0FDSEVfU1RBVFVTLlJFTkRFUl9OT19DQUNIRSwgaHRtbDogaHRtbCB9LCBjYik7XG4gICAgICAgICAgICAgICAgICAgIGJyZWFrO1xuICAgICAgICAgICAgICAgIGNhc2UgTUVTU0FHRVNfMS5FTlVNX0NBQ0hFX1NUQVRVUy5SRU5ERVJfQ0FDSEU6XG4gICAgICAgICAgICAgICAgICAgIF90aGlzLmFza0JyaWRnZSh7IHVybDogdXJsLCBzdHJhdGVneTogTUVTU0FHRVNfMS5FTlVNX0NBQ0hFX1NUQVRVUy5SRU5ERVJfQ0FDSEUsIGh0bWw6IGh0bWwgfSwgY2IpO1xuICAgICAgICAgICAgICAgICAgICBicmVhaztcbiAgICAgICAgICAgICAgICBjYXNlIE1FU1NBR0VTXzEuRU5VTV9DQUNIRV9TVEFUVVMuRVJST1I6XG4gICAgICAgICAgICAgICAgICAgIF90aGlzLnNvY2tldC5jbG9zZSgpO1xuICAgICAgICAgICAgICAgICAgICB0aHJvdyByZXNwb25zZS5lcnI7XG4gICAgICAgICAgICB9XG4gICAgICAgIH0pO1xuICAgIH07XG4gICAgQ2xpZW50LnByb3RvdHlwZS5hc2tCcmlkZ2UgPSBmdW5jdGlvbiAocXVlcnksIGNiKSB7XG4gICAgICAgIHZhciBfdGhpcyA9IHRoaXM7XG4gICAgICAgIGRlYnVnKCdFbWl0dGluZyBHRVRfVVJMIGZyb20gQ2xpZW50IHRvIEJyaWRnZScpO1xuICAgICAgICB0aGlzLnNvY2tldC5vbihNRVNTQUdFU18xLk1TRy5SRU5ERVJfU1RBVFVTLCBmdW5jdGlvbiAocmVzcG9uc2UpIHtcbiAgICAgICAgICAgIGRlYnVnKCdSZXNwb25zZSByZWNlaXZlZCBmcm9tIEJyaWRnZSBFeHRlcm5hbCcsIE1FU1NBR0VTXzEuRU5VTV9SRU5ERVJfU1RBVFVTW3Jlc3BvbnNlLnN0YXR1c10pO1xuICAgICAgICAgICAgc3dpdGNoIChyZXNwb25zZS5zdGF0dXMpIHtcbiAgICAgICAgICAgICAgICBjYXNlIE1FU1NBR0VTXzEuRU5VTV9SRU5ERVJfU1RBVFVTLkhUTUw6XG4gICAgICAgICAgICAgICAgICAgIGRlYnVnKCdDbGllbnQgLSBjbG9zaW5nIHNvY2tldCcpO1xuICAgICAgICAgICAgICAgICAgICBfdGhpcy5zb2NrZXQuY2xvc2UoKTtcbiAgICAgICAgICAgICAgICAgICAgcmV0dXJuIGNiKHtcbiAgICAgICAgICAgICAgICAgICAgICAgIHN0YXR1czogTUVTU0FHRVNfMS5FTlVNX1JFTkRFUl9TVEFUVVMuSFRNTCxcbiAgICAgICAgICAgICAgICAgICAgICAgIGh0bWw6IHJlc3BvbnNlLmh0bWxcbiAgICAgICAgICAgICAgICAgICAgfSk7XG4gICAgICAgICAgICAgICAgY2FzZSBNRVNTQUdFU18xLkVOVU1fUkVOREVSX1NUQVRVUy5TVEFSVEVEOlxuICAgICAgICAgICAgICAgIGNhc2UgTUVTU0FHRVNfMS5FTlVNX1JFTkRFUl9TVEFUVVMuUVVFVUVEOlxuICAgICAgICAgICAgICAgICAgICBicmVhaztcbiAgICAgICAgICAgICAgICBjYXNlIE1FU1NBR0VTXzEuRU5VTV9SRU5ERVJfU1RBVFVTLkVSUk9SOlxuICAgICAgICAgICAgICAgICAgICBfdGhpcy5zb2NrZXQuY2xvc2UoKTtcbiAgICAgICAgICAgICAgICAgICAgcmV0dXJuIGNiKHtcbiAgICAgICAgICAgICAgICAgICAgICAgIHN0YXR1czogTUVTU0FHRVNfMS5FTlVNX0NBQ0hFX1NUQVRVUy5FUlJPUlxuICAgICAgICAgICAgICAgICAgICB9KTtcbiAgICAgICAgICAgIH1cbiAgICAgICAgfSk7XG4gICAgICAgIHRoaXMuc29ja2V0LmVtaXQoTUVTU0FHRVNfMS5NU0cuR0VUX1VSTCwgcXVlcnkpO1xuICAgIH07XG4gICAgcmV0dXJuIENsaWVudDtcbn0oKSk7XG5tb2R1bGUuZXhwb3J0cyA9IENsaWVudDtcblxuXG5cbi8vLy8vLy8vLy8vLy8vLy8vL1xuLy8gV0VCUEFDSyBGT09URVJcbi8vIC4vc3JjL2NsaWVudC50c1xuLy8gbW9kdWxlIGlkID0gMFxuLy8gbW9kdWxlIGNodW5rcyA9IDAiLCJtb2R1bGUuZXhwb3J0cyA9IHJlcXVpcmUoXCJzb2NrZXQuaW8tY2xpZW50XCIpO1xuXG5cbi8vLy8vLy8vLy8vLy8vLy8vL1xuLy8gV0VCUEFDSyBGT09URVJcbi8vIGV4dGVybmFsIFwic29ja2V0LmlvLWNsaWVudFwiXG4vLyBtb2R1bGUgaWQgPSAxXG4vLyBtb2R1bGUgY2h1bmtzID0gMCIsIid1c2Ugc3RyaWN0JztcbmV4cG9ydHMuTVNHID0ge1xuICAgIENIRUNLX1VSTDogJ0NIRUNLX1VSTCcsXG4gICAgR0VUX1VSTDogJ0dFVF9VUkwnLFxuICAgIEFOU1dFUjogJ1BBUkFNX0NMSUVOVF9BTlNXRVInLFxuICAgIFJFTkRFUl9TVEFUVVM6ICdFTlVNX0NBQ0hFX1NUQVRVUycsXG4gICAgSURMRTogJ0lETEUnLFxuICAgIExPRzogJ0xPRycsXG4gICAgRVJST1I6ICdFUlJPUicsXG59O1xudmFyIEVOVU1fUkVOREVSX1NUQVRVUztcbihmdW5jdGlvbiAoRU5VTV9SRU5ERVJfU1RBVFVTKSB7XG4gICAgRU5VTV9SRU5ERVJfU1RBVFVTW0VOVU1fUkVOREVSX1NUQVRVU1tcIlNUQVJURURcIl0gPSAwXSA9IFwiU1RBUlRFRFwiO1xuICAgIEVOVU1fUkVOREVSX1NUQVRVU1tFTlVNX1JFTkRFUl9TVEFUVVNbXCJRVUVVRURcIl0gPSAxXSA9IFwiUVVFVUVEXCI7XG4gICAgRU5VTV9SRU5ERVJfU1RBVFVTW0VOVU1fUkVOREVSX1NUQVRVU1tcIkhUTUxcIl0gPSAyXSA9IFwiSFRNTFwiO1xuICAgIEVOVU1fUkVOREVSX1NUQVRVU1tFTlVNX1JFTkRFUl9TVEFUVVNbXCJFUlJPUlwiXSA9IDNdID0gXCJFUlJPUlwiO1xufSkoRU5VTV9SRU5ERVJfU1RBVFVTID0gZXhwb3J0cy5FTlVNX1JFTkRFUl9TVEFUVVMgfHwgKGV4cG9ydHMuRU5VTV9SRU5ERVJfU1RBVFVTID0ge30pKTtcbjtcbnZhciBFTlVNX0NBQ0hFX1NUQVRVUztcbihmdW5jdGlvbiAoRU5VTV9DQUNIRV9TVEFUVVMpIHtcbiAgICBFTlVNX0NBQ0hFX1NUQVRVU1tFTlVNX0NBQ0hFX1NUQVRVU1tcIlJFTkRFUl9DQUNIRVwiXSA9IDBdID0gXCJSRU5ERVJfQ0FDSEVcIjtcbiAgICBFTlVNX0NBQ0hFX1NUQVRVU1tFTlVNX0NBQ0hFX1NUQVRVU1tcIk5PX1JFTkRFUlwiXSA9IDFdID0gXCJOT19SRU5ERVJcIjtcbiAgICBFTlVNX0NBQ0hFX1NUQVRVU1tFTlVNX0NBQ0hFX1NUQVRVU1tcIkhUTUxcIl0gPSAyXSA9IFwiSFRNTFwiO1xuICAgIEVOVU1fQ0FDSEVfU1RBVFVTW0VOVU1fQ0FDSEVfU1RBVFVTW1wiUkVOREVSX05PX0NBQ0hFXCJdID0gM10gPSBcIlJFTkRFUl9OT19DQUNIRVwiO1xuICAgIEVOVU1fQ0FDSEVfU1RBVFVTW0VOVU1fQ0FDSEVfU1RBVFVTW1wiRVJST1JcIl0gPSA0XSA9IFwiRVJST1JcIjtcbn0pKEVOVU1fQ0FDSEVfU1RBVFVTID0gZXhwb3J0cy5FTlVNX0NBQ0hFX1NUQVRVUyB8fCAoZXhwb3J0cy5FTlVNX0NBQ0hFX1NUQVRVUyA9IHt9KSk7XG47XG52YXIgRU5VTV9TTElNRVJfRVJST1JTO1xuKGZ1bmN0aW9uIChFTlVNX1NMSU1FUl9FUlJPUlMpIHtcbiAgICBFTlVNX1NMSU1FUl9FUlJPUlNbRU5VTV9TTElNRVJfRVJST1JTW1wiRklMRV9BQ0NFU1NfRVJST1JcIl0gPSA1XSA9IFwiRklMRV9BQ0NFU1NfRVJST1JcIjtcbiAgICBFTlVNX1NMSU1FUl9FUlJPUlNbRU5VTV9TTElNRVJfRVJST1JTW1wiTkVUV09SS19FUlJPUlwiXSA9IDZdID0gXCJORVRXT1JLX0VSUk9SXCI7XG4gICAgRU5VTV9TTElNRVJfRVJST1JTW0VOVU1fU0xJTUVSX0VSUk9SU1tcIldFQkFQUF9FUlJPUlwiXSA9IDddID0gXCJXRUJBUFBfRVJST1JcIjtcbiAgICBFTlVNX1NMSU1FUl9FUlJPUlNbRU5VTV9TTElNRVJfRVJST1JTW1wiTE9HSUNfRVJST1JcIl0gPSA4XSA9IFwiTE9HSUNfRVJST1JcIjtcbn0pKEVOVU1fU0xJTUVSX0VSUk9SUyA9IGV4cG9ydHMuRU5VTV9TTElNRVJfRVJST1JTIHx8IChleHBvcnRzLkVOVU1fU0xJTUVSX0VSUk9SUyA9IHt9KSk7XG47XG5cblxuXG4vLy8vLy8vLy8vLy8vLy8vLy9cbi8vIFdFQlBBQ0sgRk9PVEVSXG4vLyAuL3NyYy9NRVNTQUdFUy50c1xuLy8gbW9kdWxlIGlkID0gMlxuLy8gbW9kdWxlIGNodW5rcyA9IDAiLCJtb2R1bGUuZXhwb3J0cyA9IHJlcXVpcmUoXCJkZWJ1Z1wiKTtcblxuXG4vLy8vLy8vLy8vLy8vLy8vLy9cbi8vIFdFQlBBQ0sgRk9PVEVSXG4vLyBleHRlcm5hbCBcImRlYnVnXCJcbi8vIG1vZHVsZSBpZCA9IDNcbi8vIG1vZHVsZSBjaHVua3MgPSAwIl0sInNvdXJjZVJvb3QiOiIifQ==